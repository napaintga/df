<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cypress Bootloader SDK: Cypress Bootloader SDK</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="cypress_logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cypress Bootloader SDK
   &#160;<span id="projectnumber">2.10</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Cypress Bootloader SDK </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="section_mainpage_overview"></a>
Overview</h1>
<p>The purpose of the Bootloader SDK is to provide a low-level SDK for bootloading firmware images. <br />
 The Bootloader SDK has the following features:</p><ul>
<li>Reading firmware images from the bootloading host through a number of transport interfaces, e.g. BLE, USB, UART, I2C, SPI, I2C.</li>
<li>Programming a firmware image to the specified address in internal Flash, SMIF, or any external memory that supports the Bootloader SDK API.</li>
<li>Copying applications.</li>
<li>Validating applications.</li>
<li>Safe Bootloading: bootloading images at temporary location, validating them and if valid, overwrite working images.</li>
<li>Switching firmware applications. Passing parameters in RAM when switching firmware applications.</li>
<li>Supports encrypted bootloader image files. <br />
 Transfers encrypted images to firmware without decrypting in the middle.</li>
<li>Supports up to 28 firmware images. Each of them can be a bootloader.</li>
<li>Supports customization.</li>
<li>CRC-32 checksum to validate firmware data.</li>
<li>Rejects firmware images for incompatible products by checking Product ID. <br />
 Rejects firmware images for incompatible chips by checking Silicon ID.</li>
<li>Designed to support Secure Library for PSoC6.</li>
<li>Can be easily ported to the PSoC4/5 and FMx Cypress device families.</li>
<li>Provides a number of code examples.</li>
</ul>
<p>The Bootloader SDK can be used for designing bootloading applications of arbitrary flexibility and complexity. Also simple for simple cases.</p>
<p>The simplest Bootloader SDK application is provided at the CE213903 - Basic Bootloader code example.</p>
<h1><a class="anchor" id="group_bootload_config"></a>
Configuration Considerations</h1>
<h2><a class="anchor" id="group_bootload_config_linker_scripts"></a>
Linker scripts</h2>
<p>The Bootloader SDK projects use linker scripts a bit different from the default startup linker scripts.</p>
<p>Changes compared to startup linker scripts:</p><ol type="1">
<li><p class="startli">bootload_common.ld for GCC, bootload_common.icf for IAR, bootload_common.h and bootload_mdk_symbols.c for MDK.</p>
<p class="startli">These files define the memory layout for each application inside the device.</p>
<p class="startli">These files are Bootloader SDK specific, the startup linker scripts define the memory layout by themselves. These common files are designed for better user experience because the Bootloader SDK contains multiple applications.</p>
</li>
<li>bootload_cm0p.{ld, icf, scat}, bootload_cm4.{ld, icf, scat} These files are the templates of linker script files for building Bootloader SDK applications. The user for GCC, IAR and MDK linkers to build CM0+ and CM4 applications. Cypress Bootloader SDK code examples use them.</li>
</ol>
<dl class="section user"><dt>File bootload_common.ld</dt><dd>This file is a GCC common linker script file. It is included into each application GCC linker script, and must have the same content across all the application projects inside the designed device.</dd></dl>
<p>Any changes made to it in any application must be copied to other applications <em>bootload_common.ld</em> files.</p>
<p>The goal of this design is to keep all the memory layout and common Bootloader SDK symbols in one file.</p>
<p>Memory regions: This file defines all the memory regions for all the applications. Such a design allows the user to have a full memory layout inside one file.</p><ul>
<li><em>flash_app{X}_core{Y}</em> - The memory region for Flash code and data of the user application {X} MCU core {Y}.</li>
<li><em>flash_storage</em> - The optional memory region to place shared or application specific code or data outside of the application.</li>
<li><em>flash_boot_meta</em> - The optional memory region for the Bootloader SDK metadata. Cypress Bootloader SDK code examples place Bootloader SDK metadata inside this region. The user is free to place it in any other way.</li>
<li><em>sflash_user_data</em>, <em>efuse</em>, <em>flash_toc</em>, <em>em_eeprom</em>, <em>xip</em> - These are the regions not used by typical Bootloader SDK code examples. They are kept because they may be used in user code.</li>
<li><em>ram_common</em> - The memory region for data that to be shared between Bootloader SDK applications. The user may place it anywhere inside the RAM, but all the applications must have the same location of it. So, one app sets some values there, switches to another app. Then that another app may read or update the values.</li>
<li><em>ram_app{X}_core{Y}</em> - The memory region for RAM data, stack, heap etc. for the user app{X} MCU core {Y}.</li>
</ul>
<p>Common ELF file symbols: CyMCUElfTool uses special ELF file symbols besides command-line arguments for its configuration. Some of these symbols have values common for all the applications and some are application-specific. Common symbols are defined in this file, while application-specific are in the linker scripts for that app.</p><ol type="1">
<li><p class="startli">__cy_memory_{N}_start - Defines the start address of the memory region. __cy_memory_{N}_length - Defines the length of the memory region. __cy_memory_{N}_row_size - Defines the row size of the memory region.</p>
<p class="startli">CyMCUElfTool uses these symbols to determine which memory regions should be placed into the HEX and CYACD2 files. I.e. without these symbols, some data like XIP may be absent in the HEX file.</p>
<p class="startli">These symbols are critical for CYACD2 file generation, CyMCUElfTool must know the row size of all the data being exported to the CYACD2 file. The bootloading is done by rows, and a row size may vary across the memory regions.</p>
<p class="startli">E.g. Internal Flash of PSoC6 devices start at address 0x1000_0000 and the length and row size may de device-dependent, but let's assume it is 512KB and 512 bytes. The memory symbols for the internal Flash will be: <code> __cy_memory_0_start = 0x10000000; __cy_memory_0_length = 512 * 1024; __cy_memory_0_row_size = 512; </code></p>
<p class="startli">The number _{N}_ in the memory symbol indicates that there may be multiple memories.</p>
</li>
<li>__cy_boot_metadata_addr and __cy_boot_metadata_length. These symbols are used by the Bootloader SDK internally to access the metadata as the metadata location is user-configurable.</li>
<li><p class="startli">__cy_product_id - used by CyMCUElfTool to be placed in the CYACD2 header. This value is used by the Bootloading Host and Bootloader SDK firmware to confirm that the CYACD2 file being bootloaded is compatible with the device.</p>
<p class="startli">E.g. The user may have two different devices with the same PSoC6 chip:</p><ul>
<li>A coffee machine, with Product ID - 0x1000_0001.</li>
<li>A nuclear power plant control device with Product ID - 0x1000_0002. The user of a coffee machine tries to bootload firmware for a nuclear power plant control device, and the Bootloader Host will indicate that the device rejected this firmware because of the wrong Product ID.</li>
</ul>
</li>
<li><p class="startli">__cy_app{N}_base, __cy_app{N}_size. These symbols are used by the bootload_user.c file to initialize the metadata. Their value is automatically updated by the linker when the user updates the memory layout (memory regions).</p>
<p class="startli">If the user decided to use a different mechanism for SDK metadata initialization, then these symbols can be removed.</p>
</li>
<li>__cy_boot_signature_size. Used by the Bootloader SDK linker scripts only. It helps avoiding the magic number for a signature size to be scattered throughout all the linker scripts. E.g.<ul>
<li>For the CRC-32C application signature, the value of this symbol is 4 (bytes).</li>
<li>For RSASSA-PCKS-1-v1.5 with RSA 2048, the value is 256 (bytes).</li>
</ul>
</li>
</ol>
<dl class="section user"><dt>File bootload_cm0p.ld</dt><dd>This file is a linker script for the CM0+ core for Bootloader SDK applications.</dd></dl>
<p>It is similar to the default startup GCC's CM0+ linker script but with some differences:</p><ol type="1">
<li>include bootload_common.ld instead of defining memory regions.</li>
<li>__cy_app_id. This ELF file symbols are used by CyMCUElfTool to set an application ID in the CYACD2 file header.</li>
</ol>
<ol type="1">
<li>__cy_app_core1_start_addr. This ELF file symbol is used for the CM0+ C code in the main_cm0p.c file to know the start address of the CM4 code. Its value gets automatically updated when the memory layout gets changed. The user should update the application number, when this linker script is used for applications other than app 0.</li>
<li>__cy_app_verify_start, __cy_app_verify_length. These two symbols are used by CyMCUElfTool to generate an application signature. The first symbol provides a value of the start of signed memory and the second - the length of signed memory.</li>
<li>Section ".cy_boot_noinit". Used to place data to be shared between the applications. See the description of the ram_common memory region.</li>
<li>Section ".cy_boot_metadata". Contains the Bootloader SDK metadata. This section name is necessary only for CyMCUElfTool to sign the section with the CRC-32C checksum of this section data. If no CRC-32C at the end of the metadata is required, then the section can be renamed.</li>
<li>No need to place __cy_memory_{N} symbols in this file, they are placed in bootload_common.ld.</li>
</ol>
<dl class="section user"><dt>File bootload_cm4.ld</dt><dd>This file is a linker script for CM0+ core for the Bootloader SDK applications.</dd></dl>
<p>It is similar to a default startup GCC's CM0+ linker script and to a CM0+ Bootloader SDK linker script but with some differences:</p>
<p>Section .cy_app_signature. This section is used to place an application signature. The signature is used by the Bootloader SDK to verify that the application is valid.</p>
<p>Typically, CRC, SHA or any other hash of the application code and data is placed here. CyMCUElfTool updates this section in the post-build step.</p>
<p>The memory for which the signature is calculated is defined by the following ELF file symbols: __cy_app_verify_start, __cy_app_verify_length.</p>
<dl class="section user"><dt>Files bootload_{cm0p, cm4}.{icf, scat}</dt><dd>These files are the linker scripts for the CM0+ and CM4 cores for IAR and MDK compilers for the Bootloader SDK applications.</dd></dl>
<p>Their difference from the default startup linker scripts are similar to the Bootloader SDK GCC's linker scripts described above.</p>
<h1><a class="anchor" id="group_bootload_more_info"></a>
More Information</h1>
<ul>
<li><a href="http://www.cypress.com/an213924">AN213924</a> Bootloader SDK User Guide</li>
<li><a href="http://www.cypress.com/ce213903">CE213903</a> Bootloader SDK Basic Communication Code Examples</li>
<li><a href="http://www.cypress.com/ce216767">CE216767</a> Bootloader SDK BLE OTA Code Example</li>
</ul>
<h1><a class="anchor" id="group_bootload_MISRA"></a>
MISRA-C Compliance</h1>
<table class="doxtable">
<tr>
<th>MISRA Rule </th><th>Rule Class (Required/Advisory) </th><th>Rule Description </th><th>Description of Deviation(s)  </th></tr>
<tr>
<td>1.1 </td><td>R </td><td>This rule states that code shall conform to C ISO/IEC 9899:1990 standard. </td><td>PDL v3.0.1 supports the ISO:C99 standard.  </td></tr>
<tr>
<td>2.3 </td><td>A </td><td>Nested comments are not recognized in the ISO standard. </td><td>The comments provide the useful WEB link to the additional documentation.   </td></tr>
<tr>
<td>3.1 </td><td>R </td><td>All usage of implementation defined behavior shall be documented </td><td>The Bootloader SDK deviates rule 11.3 which triggers rule 3.1. The ANSI symbols Dollar and Back quote are used by PDL v.3.0.1 headers before being preprocessed.  </td></tr>
<tr>
<td>5.6 </td><td>A </td><td>To avoid confusion, no identifier in one name space should have the same spelling as an identifier in another name space, with the exception of structure and union member names </td><td>This rule is deviated because the generalized implementation approach requires having the same names.  </td></tr>
<tr>
<td>8.7 </td><td>R </td><td>Objects shall be defined at block scope if they are only accessed from within a single function. That is, minimize the scope of objects and variables </td><td>For some communication APIs, an object scope can be reduced, but that is not because of the generalized implementation approach.  </td></tr>
<tr>
<td>9.2 </td><td>R </td><td>Braces shall be used to indicate and match the structure in the nonzero initialization of arrays and structures </td><td>This rule is deviated in the bootload_user.c file, it is manually checked to be valid.  </td></tr>
<tr>
<td>11.3 </td><td>A </td><td>Avoid casts between a pointer type and an integral type </td><td>There are a few casts between the pointer and uint32_t type in the cy_bootload.c file. All of them are manually verified and reviewed to be safe.  </td></tr>
<tr>
<td>11.4 </td><td>A </td><td>A cast should not be performed between a pointer to object type and a different pointer to object type. </td><td>Casts involving pointers are conducted with caution that the pointers are correctly aligned for the type of the object being pointed to.   </td></tr>
<tr>
<td>11.5 </td><td>R </td><td>Not performed, the cast that removes any const or volatile qualification from the type addressed by a pointer. </td><td>The removal of the volatile qualification inside the function has no side effects.  </td></tr>
<tr>
<td>13.7 </td><td>R </td><td>Boolean operations whose results are invariant shall not be permitted. </td><td>MISRA-C:2004 is not smart enough to understand the function is weak, thus may return values other than in the default implementation.  </td></tr>
<tr>
<td>14.1 </td><td>R </td><td>There shall be no unreachable code. This refers to code which cannot, under any circumstances, be reached. </td><td>MISRA-C:2004 does not understand that a weak function is supposed to be overwritten in the customer project. Thus assumes the function returns always the same fixed value, so any if() branch testing weak-function return-value may be treated as unreachable code.  </td></tr>
<tr>
<td>14.2 </td><td>R </td><td>All non-null statements shall either have at least one side-effect, however executed, or cause control flow to change. </td><td>MISRA-C:2004 is not smart enough to understand the intention of the (void)unused_param; statement. <br />
 GCC, MDK and IAR compilers understand the intention of this.  </td></tr>
<tr>
<td>16.7 </td><td>A </td><td>The object addressed by the pointer parameter is not modified and so the pointer could be of type 'pointer to const'. </td><td>Some Bootloader SDK functions are weak, and can be redefined in the user code. They contain non-const pointer parameters intentionally to be more generic .  </td></tr>
<tr>
<td>17.4 </td><td>R </td><td>Array indexing shall be the only allowed form of pointer arithmetic  </td><td>There are several instances of the pointer arithmetic in cy_bootload.c. They cannot be avoided, so are manually checked and reviewed to be safe.  </td></tr>
<tr>
<td>19.7 </td><td>A </td><td>A function shall be used in preference to a function-like macro </td><td>Function-like macros are used for performance reasons.  </td></tr>
<tr>
<td>19.13 </td><td>A </td><td>Avoid use of the # and ## preprocessor directives when possible </td><td>The directive ## of the preprocessor used in the transport_uart/i2c/spi.c. The use of ## is intentional and allows setting the UART/I2C/SPI component name in one place and does not change it throughout the whole transport_uart/i2c/spi.c file.  </td></tr>
<tr>
<td>21.1 </td><td>R </td><td>Minimization of run-time failures shall be ensured by the use of at least one of:<ul>
<li>static analysis tools/techniques;</li>
<li>dynamic analysis tools/techniques;</li>
<li>explicit coding of checks to handle run-time faults. </li>
</ul>
</td><td>Redundant operations are present because of the generalized implementation approach.  </td></tr>
</table>
<h1><a class="anchor" id="group_bootload_changelog"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version</th><th>Changes</th><th>Reason for Change </th></tr>
<tr>
<td rowspan="2">2.20 </td><td>Add check of application number in Set Application Metadata command processing routine.  </td><td>Prevent incorrect usage of the Set Application Metadata command.   </td></tr>
<tr>
<td>Minor documentation updates </td><td>Documentation improvement  </td></tr>
<tr>
<td>2.10 </td><td>Moved address and golden image checks from cy_bootload.c to <a class="el" href="group__group__bootload__functions.html#gac331ceb09ed71f0c2fdf9c0ea3389ff4">Cy_Bootload_WriteData()</a> in bootload_user.c, so the checks can be customized based on application needs.  </td><td>Allows receiving an update for the running app use case. Improvements made based on usability feedback. Documentation update and clarification.   </td></tr>
<tr>
<td>2.0 </td><td><ul>
<li>
Use the shared RAM for application switching instead of the BACKUP register. </li>
<li>
Add support of secure application verification. </li>
<li>
Add support of I2C/SPI/BLE transport protocols. </li>
<li>
Linker scripts updated for PSoC6 Rev *A devices. </li>
<li>
Made CRC default application checksum. </li>
</ul>
</td><td>To increase functionality.  </td></tr>
<tr>
<td>1.0 </td><td>Initial version. </td><td></td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>Cypress Bootloader SDK</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
