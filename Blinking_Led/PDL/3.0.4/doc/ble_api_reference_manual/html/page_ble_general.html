<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cypress BLE Middleware Library: General Description</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="cypress_logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cypress BLE Middleware Library
   &#160;<span id="projectnumber">2.20</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_ble_general.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">General Description </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Bluetooth Low Energy (BLE) middleware contains a comprehensive API list to allow you to configure the BLE Stack and the underlying chip hardware.</p>
<p><b>Features:</b></p><ul>
<li>Multi-link support up to four simultaneous connections in any combination of roles</li>
<li>Bluetooth v5.0 compliant protocol stack<ul>
<li>LE 2 Mbps</li>
</ul>
</li>
<li>Generic Access Profile (GAP) Features<ul>
<li>Broadcaster, Observer, Peripheral and Central roles</li>
<li>User-defined advertising data</li>
<li>Bonding support for up to 128 devices</li>
<li>Security modes 1 and 2</li>
</ul>
</li>
<li>Generic Attribute Profile (GATT) Features<ul>
<li>GATT Client and Server</li>
<li>16-, 32-, and 128-bit UUIDs</li>
</ul>
</li>
<li>Special Interest Group (SIG) adopted GATT-based Profiles and Services, and quick prototype of new profile design through intuitive GUI Custom Profile development; Support of Bluetooth Developer Studio Profile format</li>
<li>Security Manager features<ul>
<li>Pairing methods: Just works, Passkey Entry, Out of Band, Numeric Comparison</li>
<li>Authenticated man-in-the-middle (MITM) protection and data signing</li>
</ul>
</li>
<li>Logical Link Adaption Protocol (L2CAP) Connection Oriented Channel</li>
<li>Link Layer (LL) Features<ul>
<li>Master and Slave role</li>
<li>128-bit AES encryption</li>
<li>Low Duty Cycle Advertising</li>
<li>LE Ping</li>
</ul>
</li>
</ul>
<p>The BLE middleware incorporates a Bluetooth Core Specification v5.0 compliant protocol stack. You may access the GAP, GATT and L2CAP layers of the stack using provided API.</p>
<p>The API are broadly categorized as follows:</p><ul>
<li><a class="el" href="group__group__ble__common__api.html">BLE Common API</a></li>
<li><a class="el" href="group__group__ble__service__api.html">BLE Service-Specific API</a></li>
<li><a class="el" href="group__group__ble__clock__api__section.html">BLE Clock API</a></li>
</ul>
<h1><a class="anchor" id="group_ble_when_use"></a>
When to use the BLE Middleware</h1>
<p>BLE is used in very low-power network and Internet of Things (IoT) solutions aimed for low-cost battery operated devices that can quickly connect and form simple wireless links. Target applications include HID, remote controls, sports and fitness monitors, portable medical devices and smart phone accessories, among many others that are being added to a long list of BLE supporting solutions.</p>
<h1><a class="anchor" id="group_ble_sig_adopted"></a>
SIG adopted Profiles and Services</h1>
<p>The BLE_PDL Component supports numerous SIG-adopted GATT-based Profiles and Services. Each of these can be configured for either a GATT Client or GATT Server. The Component generates all the necessary code for a particular Profile/Service operation, as configured in the Component Configure dialog.</p>
<h1><a class="anchor" id="group_ble_custom_profile"></a>
Custom Profiles</h1>
<p>You can create custom Profiles that use existing Services, and you can create custom Services with custom Characteristics and Descriptors.</p>
<h1><a class="anchor" id="group_ble_debug_support"></a>
Debug Support</h1>
<p>For testing and debugging, the Component can be configured to HCI mode through a Component-embedded UART. See General Tab - BLE Controller only (HCI over UART). For over-the-air verification, the Cypress CySmart Central Emulation Tool can be used for generic Bluetooth host stack emulation. To launch this tool, right-click on the Component and select Launch CySmart.</p>
<h1><a class="anchor" id="group_ble_architecture"></a>
BLE Middleware Architecture</h1>
<p>The BLE_PDL Component consists of the BLE Stack, BLE Profile, BLE_PDL Component Hardware Abstraction Layer (HAL), and the Link Layer. The following figure shows a high-level architecture of the BLE_PDL Component, illustrating the relationship between each of the layers and the route in which the application interacts with the Component. Note that the application is informed of the BLE events through the use of callback functions. You may build your state machine using these. Refer to the Callback Functions section for more details.</p>
<p> <style>div.image img[src="ble_architecture.png"]{width:613px;}</style>  </p><div class="image">
<img src="ble_architecture.png" alt="ble_architecture.png"/>
</div>
<p>The following sub-sections give an overview of each of these layers.</p>
<h2><a class="anchor" id="group_ble_stack"></a>
BLE Stack</h2>
<p>The BLE stack implements the core BLE functionality as defined in Bluetooth Core Specification 5.0. The stack is included as a precompiled library and is included in the BLE Middleware library. The BLE Stack implements the layered architecture of the BLE protocol stack as shown in the following figure.</p>
<div class="image">
<img src="ble_stack.png" alt="ble_stack.png"/>
</div>
<h3><a class="anchor" id="subsubsection_ble_stack_1"></a>
Generic Access Profile (GAP)</h3>
<p>The Generic Access Profile defines the generic procedures related to discovery of Bluetooth devices and link management aspects of connecting to Bluetooth devices. In addition, this profile includes common format requirements for parameters accessible on the user interface level.</p>
<p>The Generic Access Profile defines the following roles when operating over the LE physical channel:</p><ul>
<li><b>Broadcaster role</b>: A device operating in the Broadcaster role can send advertising events. It is referred to as a Broadcaster. It has a transmitter and may have a receiver.</li>
<li><b>Observer role</b>: A device operating in the Observer role is a device that receives advertising events. It is referred to as an Observer. It has a receiver and may have a transmitter.</li>
<li><b>Peripheral role</b>: A device that accepts the establishment of an LE physical link using any of the connection establishment procedures is termed to be in a "Peripheral role." A device operating in the Peripheral role will be in the "Slave role" in the Link Layer Connection State. A device operating in the Peripheral role is referred to as a Peripheral. A Peripheral has both a transmitter and a receiver.</li>
<li><b>Central role</b>: A device that supports the Central role initiates the establishment of a physical connection. A device operating in the "Central role" will be in the "Master role" in the Link Layer Connection. A device operating in the Central role is referred to as a Central. A Central has a transmitter and a receiver.</li>
</ul>
<h3><a class="anchor" id="subsubsection_ble_stack_2"></a>
Generic Attribute Profile (GATT)</h3>
<p>The Generic Attribute Profile defines a generic service framework using the ATT protocol layer. This framework defines the procedures and formats of services and their Characteristics. It defines the procedures for Service, Characteristic, and Descriptor discovery, reading, writing, notifying, and indicating Characteristics, as well as configuring the broadcast of Characteristics. GATT Roles</p><ul>
<li><b>GATT Client</b>: This is the device that wants data. It initiates commands and requests towards the GATT Server. It can receive responses, indications, and notifications data sent by the GATT Server.</li>
<li><b>GATT Server</b>: This is the device that has the data and accepts incoming commands and requests from the GATT Client and sends responses, indications, and notifications to a GATT Client. The BLE Stack can support both roles simultaneously.</li>
</ul>
<h3><a class="anchor" id="subsubsection_ble_stack_3"></a>
Attribute Protocol (ATT)</h3>
<p>The Attribute Protocol layer defines a Client/Server architecture above the BLE logical transport channel. The attribute protocol allows a device referred to as the GATT Server to expose a set of attributes and their associated values to a peer device referred to as the GATT Client. These attributes exposed by the GATT Server can be discovered, read, and written by a GATT Client, and can be indicated and notified by the GATT Server. All the transactions on attributes are atomic.</p>
<h3><a class="anchor" id="subsubsection_ble_stack_4"></a>
Security Manager Protocol (SMP)</h3>
<p>Security Manager Protocol defines the procedures and behavior to manage pairing, authentication, and encryption between the devices. These include:</p><ul>
<li>Encryption and Authentication</li>
<li>Pairing and Bonding<ul>
<li>Pass Key and Out of band bonding</li>
</ul>
</li>
<li>Key Generation for a device identity resolution, data signing and encryption</li>
<li>Pairing method selection based on the IO capability of the GAP central and GAP peripheral device</li>
</ul>
<h3><a class="anchor" id="subsubsection_ble_stack_5"></a>
Logical Link Control Adaptation Protocol (L2CAP)</h3>
<p>L2CAP provides a connectionless data channel. LE L2CAP provides the following features:</p><ul>
<li>Channel multiplexing, which manages three fixed channels. Two channels are dedicated for higher protocol layers like ATT, SMP. One channel is used for the LE-L2CAP protocol signalling channel for its own use.</li>
<li>Segmentation and reassembly of packets whose size is up to the BLE Controller managed maximum packet size.</li>
<li>Connection-oriented channel over a specific application registered using the PSM (protocol service multiplexer) channel. It implements credit-based flow control between two LE L2CAP entities. This feature can be used for BLE applications that require transferring large chunks of data.</li>
</ul>
<h3><a class="anchor" id="subsubsection_ble_stack_6"></a>
Host Controller Interface (HCI)</h3>
<p>The HCI layer implements a command, event, and data interface to allow link layer access from upper layers such as GAP, L2CAP, and SMP.</p>
<h3><a class="anchor" id="subsubsection_ble_stack_7"></a>
Link Layer (LL)</h3>
<p>The HCI layer implements a command, event, and data interface to allow link layer access from upper layers such as GAP, L2CAP, and SMP. The LL protocol manages the physical BLE connections between devices. It supports all LL states such as Advertising, Scanning, Initiating, and Connecting (Master and Slave). It implements all the key link control procedures such as LE Encryption, LE Connection Update, LE Channel Update, and LE Ping. The Link Layer is a hardware-firmware co-implementation, where the key time critical LL functions are implemented in the LL hardware. The LL firmware maintains and controls the key LL procedure state machines. It supports all the BLE chip specific low-power modes. The BLE Stack is a pre-compiled library in the BLE_PDL Component. The appropriate configuration of the BLE Stack library is linked during a build process based on application. The BLE Stack libraries are ARM Embedded Application Binary Interface(EABI) compliant and they are compiled using ARM compiler version 5.03. The following table shows the mapping between the BLE Stack library to the user-configured Complete BLE Protocol mode or HCI mode. Refer to the <b>General Tab</b> section of <a href="http://www.cypress.com/documentation/component-datasheets/bluetooth-low-energy-blepdl">Bluetooth Low Energy (BLE_PDL) Datasheet</a> for selection of stack configuration.</p>
<table class="doxtable">
<tr>
<th><b>BLE Middleware Configuration</b> </th><th><b>CPU Core </b> </th><th><p class="starttd"><b>BLE Stack Libraries</b> </p>
<p class="endtd"></p>
</th></tr>
<tr>
<td rowspan="2"><b>Complete BLE Protocol.</b><br />
Host and Controller on single core with software interface  </td><td>Single core (Complete Component on CM4)  </td><td>cy_ble_stack_gcc_radio_max_cm4.a <br />
 cy_ble_stack_gcc_soc_cm4.a   </td></tr>
<tr>
<td>Single core (Complete Component on CM0+)  </td><td><p class="starttd">cy_ble_stack_gcc_radio_max_cm0p.a <br />
 cy_ble_stack_gcc_soc_cm0p.a  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td><b>Complete BLE Protocol.</b><br />
Host and Controller on dual core with IPC interface  </td><td>Dual core (Controller on CM0+, Host and Profile on CM4) </td><td><p class="starttd">cy_ble_stack_gcc_radio_max_cm0p.a <br />
 cy_ble_stack_gcc_controller_ipc_cm0p.a <br />
 cy_ble_stack_gcc_host_ipc_cm4.a  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td rowspan="2"><b>HCI mode.</b>  </td><td>CM4  </td><td>cy_ble_stack_gcc_radio_max_cm4.a <br />
 cy_ble_stack_gcc_controller_uart_cm4.a   </td></tr>
<tr>
<td>CM0+ </td><td>cy_ble_stack_gcc_radio_max_cm0p.a <br />
 cy_ble_stack_gcc_controller_uart_cm0p.a   </td></tr>
</table>
<p>BLE Middleware Configuration mode and CPU Core parameters can be configured in the <a href="http://www.cypress.com/documentation/component-datasheets/bluetooth-low-energy-blepdl"><b>General Tab</b> of BLE Configuration Tool</a>.</p>
<p>There are two sets of libraries:</p><ul>
<li>"_gcc_" libraries are built with wchar_t typedef set to 32-bit.</li>
<li>"_mdk_" libraries are built with wchar_t set to 16-bit. <dl class="section note"><dt>Note</dt><dd>The "_gcc_" libraries are used for the IAR compiler.</dd></dl>
</li>
</ul>
<h2><a class="anchor" id="group_ble_profile_layer"></a>
Profile Layer</h2>
<p>In BLE, data is organized into concepts called Profiles, Services, and Characteristics.</p><ul>
<li>A <b>Profile</b> describes how devices connect to each other to find and use Services. It is a definition used by Bluetooth devices to describe the type of application and the general expected behavior of that device. See the to the <b>Component Parameters</b> section of <a href="http://www.cypress.com/documentation/component-datasheets/bluetooth-low-energy-blepdl">Bluetooth Low Energy (BLE_PDL) Datasheet</a> for how to configure the BLE Middleware.</li>
<li>A <b>Service</b> is a collection of data entities called Characteristics. A Service is used to define a certain function in a Profile. A Service may also define its relationship to other Services. A Service is assigned a Universally Unique Identifier (UUID). This is 16 bits for SIG adopted Services and 128 bits for custom Services. See the <b>GATT Settings Tab</b> section of <a href="http://www.cypress.com/documentation/component-datasheets/bluetooth-low-energy-blepdl">Bluetooth Low Energy (BLE_PDL) Datasheet</a> for information about adding Services to a Profile.</li>
<li>A <b>Characteristic</b> contains a Value and the Descriptor that describes a Characteristic Value. It is an attribute type for a specific piece of information within a Service. Like a Service, each Characteristic is designated with a UUID; 16 bits for SIG adopted Characteristics and 128 bits for custom Characteristics. See the <b>GATT Settings Tab</b> section of <a href="http://www.cypress.com/documentation/component-datasheets/bluetooth-low-energy-blepdl">Bluetooth Low Energy (BLE_PDL) Datasheet</a> for information about adding Characteristics and Descriptors. The following diagram shows the relationship between Profiles, Services, and Characteristics in a sample BLE heart rate monitor application using a Heart Rate Profile.</li>
</ul>
<p> <style>div.image img[src="ble_profiles.png"]{width:70%;}</style>  </p><div class="image">
<img src="ble_profiles.png" alt="ble_profiles.png"/>
</div>
<p>The Heart Rate Profile contains a Heart Rate Service and a Device Information Service. Within the Heart Rate Service, there are three Characteristics, each containing different information. The device in the diagram is configured as a Sensor role, meaning that in the context of the Heart Rate Profile, the device is a GAP Peripheral and a GATT Server. These concepts are explained in the <a class="el" href="page_ble_general.html#group_ble_stack">BLE Stack</a> description.</p>
<p>The Profile layer is generated by PSoC Creator using the parameter configurations specified in the GUI. The Profile implements the Profile specific attribute database and APIs required for the application. You can choose to configure the standard SIG adopted Profile and generate a design or define a Custom Profile required by an application. The GUI also allows import/export of a Profile design in XML format for Profile design reuse. In addition, the Bluetooth Developer Studio compliant XML format is available.</p>
<h2><a class="anchor" id="group_ble_hal"></a>
Hardware Abstraction Layer (HAL)</h2>
<p>The HAL implements the interface between the BLE stack and the underlying hardware. This layer is meant for the stack only and it is not advisable to modify it. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>Cypress BLE Middleware Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
